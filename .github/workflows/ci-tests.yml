name: ipc-chip-tests

on:
  repository_dispatch:
    types: [ci-tests]

jobs:
  zftlabs-tests:
    runs-on: ubuntu-latest

    env:
      SHA: ${{ github.event.client_payload.sha }}

    steps:
      - run: 'echo "payload: ${{ toJson(github.event.client_payload) }}"'
      - run: 'env'

      - name: Executing tests
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.ZFTLABS_HOST }}
          username: ${{ secrets.ZFTLABS_USER }}
          port: ${{ secrets.ZFTLABS_PORT }}
          key: ${{ secrets.ZFTLABS_KEY }}
          envs: SHA,TERM
          script: |
            env
            py.test -v
